machine:
  services:
    - docker

dependencies:
  override:
    - docker info
    - docker pull tdeheurles/vbox-vagrant

test:
  override:
    - apt-get update                                                                                                 
    - apt-get install curl -y                                                                                        
    - mkdir /downloads                                                                                               
    - cd /downloads                                                                                                  
    - curl -L http://download.virtualbox.org/virtualbox/5.0.2/virtualbox-5.0_5.0.2-102096~Ubuntu~trusty_amd64.deb -O 
    - mv virtualbox-5.0_5.0.2-102096~Ubuntu~trusty_amd64.deb $vbox_pathfi /downloads/virtualbox.deb                  
    - curl -L https://dl.bintray.com/mitchellh/vagrant/vagrant_1.7.4_x86_64.deb -O                                   
    - mv vagrant_1.7.4_x86_64.deb $vbox_pathfi /downloads/vagrant.deb                                                
    - apt-get install dkms -y                                                                                        
    - sudo apt-get install linux-headers-generic virtualbox-dkms
    - apt-get install -y libssl1.0.0                                                                                 
    - apt-get install -y libvpx1                                                                                     
    - apt-get install -y libsdl1.2debian                                                                             
    - apt-get install -y libqtgui4                                                                                   
    - apt-get install -y libqtcore4                                                                                  
    - apt-get install -y libqt4-opengl                                                                               
    - apt-get install -y libqt4-network                                                                              
    - apt-get install -y libpython2.7                                                                                
    - apt-get install -y libgl1                                                                                      
    - apt-get install -y libgl1-mesa-glx                                                                             
    - apt-get install -y libcurl3                                                                                    
    - apt-get install -y libxcursor1                                                                                 
    - apt-get install -y libxinerama1                                                                                
    - apt-get install -y libxmu6                                                                                     
    - apt-get install -y psmisc                                                                                      
    - dpkg -i /downloads/virtualbox.deb
    - /etc/init.d/vboxdrv setup
    - dpkg -i /downloads/vagrant.deb
    - apt-get install -y git
    - apt-get autoremove
    - rm -rf /downloads
    - mkdir /repository
    - cd /repository ; git clone http://github.com/tdeheurles/homecores
    - chmod 755 /repository/homecores/test/test.sh
    - cd /repository/homecores ; ./test/test.sh

    # - wget http://security.ubuntu.com/ubuntu/pool/main/l/linux-lts-trusty/linux-headers-3.13.0-61_3.13.0-61.100~precise1_all.deb
    # - sudo dpkg -i linux-headers-3.13.0-61_3.13.0-61.100~precise1_all.deb
    # - wget http://security.ubuntu.com/ubuntu/pool/main/l/linux/linux-headers-3.13.0-61-generic_3.13.0-61.100_amd64.deb
    # - sudo dpkg -i linux-headers-3.13.0-61-generic_3.13.0-61.100_amd64.deb
    # - /etc/init.d/vboxdrv setup
    # - sudo /etc/init.d/virtualbox status
    # - container_id=`docker run --name hctest -d tdeheurles/vbox-vagrant sh -c " while true; do sleep 1; done"`
    # - sudo lxc-attach -n "$(docker inspect --format '{{.Id}}' hctest)" -- bash -c "apt-get update"
    # - sudo lxc-attach -n "$(docker inspect --format '{{.Id}}' hctest)" -- bash -c "apt-get install wget"
    # - sudo lxc-attach -n "$(docker inspect --format '{{.Id}}' hctest)" -- bash -c "wget http://security.ubuntu.com/ubuntu/pool/main/l/linux-lts-trusty/linux-headers-3.13.0-61_3.13.0-61.100~precise1_all.deb"
    # - sudo lxc-attach -n "$(docker inspect --format '{{.Id}}' hctest)" -- bash -c "dpkg -i linux-headers-3.13.0-61_3.13.0-61.100~precise1_all.deb"
    # - sudo lxc-attach -n "$(docker inspect --format '{{.Id}}' hctest)" -- bash -c "wget http://security.ubuntu.com/ubuntu/pool/main/l/linux/linux-headers-3.13.0-61-generic_3.13.0-61.100_amd64.deb"
    # - sudo lxc-attach -n "$(docker inspect --format '{{.Id}}' hctest)" -- bash -c "dpkg -i linux-headers-3.13.0-61-generic_3.13.0-61.100_amd64.deb"
    # - sudo lxc-attach -n "$(docker inspect --format '{{.Id}}' hctest)" -- bash -c "/etc/init.d/vboxdrv setup"
    # - sudo lxc-attach -n "$(docker inspect --format '{{.Id}}' hctest)" -- bash -c "mkdir /repository"
    # - sudo lxc-attach -n "$(docker inspect --format '{{.Id}}' hctest)" -- bash -c "cd /repository ; git clone http://github.com/tdeheurles/homecores"
    # - sudo lxc-attach -n "$(docker inspect --format '{{.Id}}' hctest)" -- bash -c "chmod 755 /repository/homecores/test/test.sh"
    # - sudo lxc-attach -n "$(docker inspect --format '{{.Id}}' hctest)" -- bash -c "cd /repository/homecores ; ./test/test.sh"
    # - sudo lxc-attach -n "$(docker inspect --format '{{.Id}}' hctest)" -- bash -c "VBoxManage --version" 
